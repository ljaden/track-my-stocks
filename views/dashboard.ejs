<%- include('partials/header') %>
<%- include('components/navbar.ejs') %>


<!-- A button to open the popup form -->
<div class="container">
  <button class="open-button btn btn-primary" onclick="openForm()">+</button>
</div>

<!-- The form -->
<div class="form-popup" id="myForm">
  <form action="/dashboard" class="form-container" method="post">
    <h2>Add a new stock</h2>

    <input type="text" placeholder="$Ticker" name="ticker" onkeyup="this.value = this.value.toUpperCase()" required />

    <input type="text" placeholder="# of Shares" name="shares" required />

    <input type="text" placeholder="Cost Per Share" name="cost" required />

    <button type="text" class="btn">Add</button>
    <button type="button" class="btn cancel" onclick="closeForm()">
      Close
    </button>
  </form>
</div>

<main>
  <div class="container">
<h1 id="portfolioValue">$<%= stocks.value.toFixed(2) %></h1>
  <table class="table table-hover">
    <thead>
      <tr>
        <th>Ticker</th>
        <th>Shares</th>
        <th>Price</th>
        <th>P/L</th>
        <th>Average CPS</th>
        <th>Market Value</th>
      </tr>
    </thead>

    <tbody>
      <% stocks.forEach(stock => {%>
      <tr>
        <td><a href='/stocks/ticker?symbol=<%=stock.ticker%>'><%= stock.ticker%></a>
          <form action="/dashboard/deleteStock/<%=stock.id%>?_method=DELETE"
            method="POST">
           
            <button type="submit"><i class="fa-solid fa-trash-can"></i></button>
          </form>
        </td>
        <td><%= stock.shares%></td>
        <td>$<%= stock.price.currPrice%></td>
        <td class="<%= stock.profitLoss > 0 ? "positive": "negative" %>">$<%= stock.profitLoss%></td>
        <td>$<%= stock.avgCPS%></td>
        <td>$<%= stock.marketValue%></td>
      </tr>
      <%})%>
    </tbody>
  </table>
</div>
</main>

<script>
  function openForm() {
    document.getElementById("myForm").style.display = "block";
  }

  function closeForm() {
    document.getElementById("myForm").style.display = "none";
  }

</script>
<%- include('partials/footer') %>
